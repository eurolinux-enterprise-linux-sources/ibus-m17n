From 5361401e0387f27360d545e077d66b9492924e7b Mon Sep 17 00:00:00 2001
From: Daiki Ueno <ueno@unixuser.org>
Date: Tue, 4 Jan 2011 16:09:09 +0900
Subject: [PATCH] Give Indic engines higher rank.

https://bugzilla.redhat.com/show_bug.cgi?id=641243
---
 src/m17nutil.c |   65 +++++++++++++++++++++++++++++++++++++------------------
 1 files changed, 44 insertions(+), 21 deletions(-)

diff --git a/src/m17nutil.c b/src/m17nutil.c
index 257f68e..06f5848 100644
--- a/src/m17nutil.c
+++ b/src/m17nutil.c
@@ -7,24 +7,48 @@
 static MConverter *utf8_converter = NULL;
 static MConverter *utf32_converter = NULL;
 
-static const gchar *keymap[] = {
-    "m17n:as:phonetic",
-    "m17n:bn:inscript",
-    "m17n:gu:inscript",
-    "m17n:hi:inscript",
-    "m17n:kn:kgp",
-    "m17n:ks:kbd",
-    "m17n:mai:inscript",
-    "m17n:ml:inscript",
-    "m17n:mr:inscript",
-    "m17n:ne:rom",
-    "m17n:or:inscript",
-    "m17n:pa:inscript",
-    "m17n:sa:harvard-kyoto",
-    "m17n:sd:inscript",
-    "m17n:si:wijesekera",
-    "m17n:ta:tamil99",
-    "m17n:te:inscript"
+static const struct {
+    const gchar *name;
+    gint rank;
+} keymap[] = {
+    /* Indic engines representing each script. */
+    { "m17n:as:phonetic", 2 },
+    { "m17n:bn:inscript", 2 },
+    { "m17n:gu:inscript", 2 },
+    { "m17n:hi:inscript", 2 },
+    { "m17n:kn:kgp", 2 },
+    { "m17n:ks:kbd", 2 },
+    { "m17n:mai:inscript", 2 },
+    { "m17n:ml:inscript", 2 },
+    { "m17n:mr:inscript", 2 },
+    { "m17n:ne:rom", 2 },
+    { "m17n:or:inscript", 2 },
+    { "m17n:pa:inscript", 2 },
+    { "m17n:sa:harvard-kyoto", 2 },
+    { "m17n:sd:inscript", 2 },
+    { "m17n:si:wijesekera", 2 },
+    { "m17n:ta:tamil99", 2 },
+    { "m17n:te:inscript", 2 },
+    /* Other Indic engines should be selected by default:
+       https://bugzilla.redhat.com/show_bug.cgi?id=640896
+     */
+    { "m17n:as:*", 1 },
+    { "m17n:bn:*", 1 },
+    { "m17n:gu:*", 1 },
+    { "m17n:hi:*", 1 },
+    { "m17n:kn:*", 1 },
+    { "m17n:ks:*", 1 },
+    { "m17n:mai:*", 1 },
+    { "m17n:ml:*", 1 },
+    { "m17n:mr:*", 1 },
+    { "m17n:ne:*", 1 },
+    { "m17n:or:*", 1 },
+    { "m17n:pa:*", 1 },
+    { "m17n:sa:*", 1 },
+    { "m17n:sd:*", 1 },
+    { "m17n:si:*", 1 },
+    { "m17n:ta:*", 1 },
+    { "m17n:te:*", 1 }
 };
 
 void
@@ -119,9 +143,8 @@ ibus_m17n_engine_new (MSymbol  lang,
     engine->rank = 0;
 
     for (i = 0; i < G_N_ELEMENTS(keymap); i++) {
-        if (strcmp (engine_name, keymap[i]) == 0) {
-            /* set rank of default keymap to 1 */
-            engine->rank = 1;
+        if (g_pattern_match_simple (keymap[i].name, engine_name)) {
+            engine->rank = keymap[i].rank;
             break;
         }
     }
-- 
1.7.3.4

